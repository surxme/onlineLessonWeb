<style>
    #admincomment{
        /*min-height: 90%;*/
    }
    #admincomment .card{
        min-height: 100%;
    }
    #admincomment #edit,#del{
        color: #ffffff;
    }
    #admincomment .table td img{
        width: 55px;
        height: 30px;
         border-radius: 5%;
    }
    .layui-btn-xs{
        font-size: 11px;
    }
</style>

{layout name="layouts/layout" /}
<div class="row">
    <div class="col-md-12 grid-margin">
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <form class="forms-sample filters">
                        <div class="">
                            <div class="input-group col-xs-12">
                                <input type="text" class="form-control form-control-sm" placeholder="输入关键词" name="search_key">
                                <span class="input-group-append"><button class="btn btn-info search-btn" type="button">搜索</button></span>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row"  id="admincomment">
    <div class="col-lg-12 grid-margin">
        <div class="card">
            <div class="card-body">
                <div class="align-items-center mb-1 justify-content-between d-lg-flex d-xl-flex d-md-block d-block">
                    <h2 class="">评论总览</h2>
                    <div class="nav-wrapper d-inline-block mt-4 mt-lg-0">
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>用户</th>
                            <th>用户类型</th>
                            <th>内容</th>
                            <th>相关视频</th>
                            <th>所属课程</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        {volist name='list' id='vo'}
                        <tr>
                            <td>{$i}</td>
                            <td>{$vo.name}</td>
                            <td><label class="badge {$vo['user_type']==1?'badge-info':'badge-success'}">{$vo.type_name}</label></td>
                            <td title="{$vo.content}">{$vo.content|msubstr=0,20,'utf-8',true}</td>
                            <td>{$vo.video_name}</td>
                            <td>{$vo.lesson_name}</td>
                            <td>
                                {if condition="$vo['user_type'] eq 1"}
                                    {if condition="$vo['is_banned'] eq 0"}
                                    <a class="layui-btn layui-btn-xs comment_ban" lay-event="edit"
                                       data-id="{$vo.id}" data-title="确认禁言" data-href="{:url('admin/commentBan',['id'=>$vo.id])}">禁言</a>
                                    {else /}
                                    <a class="layui-btn layui-btn-xs comment_ban" lay-event="edit"
                                       data-id="{$vo.id}" data-title="确认解除禁言" data-href="{:url('admin/commentRelieveBan',['id'=>$vo.id])}">解除禁言</a>
                                    {/if}
                                {/if}
                                <a class="layui-btn layui-btn-danger layui-btn-xs comment_del" lay-event="del" data-id="{$vo.id}" data-href="{:url('admin/commentDel',['id'=>$vo.id])}">删除</a>
                            </td>
                        </tr>
                        {/volist}
                        </tbody>
                    </table>
                    <div class="d-flex align-items-center justify-content-between flex-wrap">
                        <p class="mb-0"> 共 {$list->total()} 条</p>
                        <nav>
                            {$list->render()}
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.search-btn').on('click',function () {
            var params = $('.filters').serialize();
            refreshDom('{:url("admin/comment")}',params,'#admincomment .table-responsive');
        });

        $('input[name=search_key]').bind('keydown',function(e){
            if (e.keyCode == 13) {
                var params = $('.filters').serialize();
                refreshDom('{:url("admin/comment")}',params,'#admincomment .table-responsive');
                return false;
            }
        });

        $('.comment_ban').on('click',function () {
            var url = $(this).data('href');
            var title = $(this).data('title');

            layui_iframe.alertConfirm(title,function (index) {
                    $.post(url,{},function (data) {
                        if(data.is_ok=='ok'){
                            location.reload();//刷新页面
                            layer.msg(data.msg,{icon:6});
                        }else{
                            layer.msg(data.msg,{icon:5});
                        }
                    });
            })
        });

        $('.comment_del').on('click',function () {
            var url = $(this).data('href');

            layui.use("layer", function () {
                var layer = layui.layer;  //layer初始化
                layer.confirm('确认删除',{btn:['确认','取消']},
                    function () {
                        $.post(url,{},function (data) {
                            if(data.is_ok=='ok'){
                                location.reload();//刷新页面
                                layer.msg(data.msg,{icon:6});
                            }else{
                                layer.msg(data.msg,{icon:5});
                            }
                        });
                    });
            });
        });
    });

</script>